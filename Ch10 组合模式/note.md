# 命令模式

## 定义

组合模式将对象组合成树形结构，以表示“部分-整体”的层次结构。
除了用来表示树形结构之外，组合模式的另一个好处是通过对象的多态性表现，
使得用户对单个对象和组合对象的使用具有一致性。

## 在JS中的实现

这应该也是静态类型语言由于自身的限制催生的解决办法。由于类的限制，对于树状数据结构，其分支节点和叶节点必然从属与不同的类，但是这又给递归调用带来了麻烦。为此人们想到的解决办法就是，为分支节点和叶节点创建共同的超类，这样他们就有了共同的方法。当递归调用的时候就比较方便了。

（分支节点的方法是调用下属节点的同名方法，叶节点的方法是执行具体的操作）

由于JS是动态类型语言，所以没有这个限制，只要叶子节点和分支节点有同名的方法并支持递归调用就可以了。用不着特地准备超类。

```
             +-------------+
             |    图形组    |
             +-------------+
             /      |      \
      +-----+   +-------+    +------+
      | 图元 |   | 图形组 |    | 图元 |
      +-----+   +-------+    +------+
                /       \
           +-----+   +------+ 
           | 图元 |   | 图元 |
           +-----+   +------+ 
```

## 我的理解

客观世界中的事物，通常都可以抽象为树状结构。树也是数据结构中非常重要的一个内容。所以组合模式在实际应用中还是比较常见的。

在 EDPFNT+ web组件中，前端渲染NT+图形文件的时候，就用到了组合模式（虽然当时还不知道这个叫法）。图形文件中包含各类基本图元，以及图形组（可包含若干图形组和图元），由此就可以构成一个树状结构。图形组和图元都提供draw函数，这样在绘制界面的时候，直接调用一次根节点的 draw 函数就可以了。

## 其他

一般的使用，树状结构的指令传递都是由上至下的（根节点到叶节点），如果要实现反向的数据传递，就需要叶节点包含父节点的引用。这也可以避免节点被多处引用（一个节点在树种出现多次）。

当然，这同时也增加了数据结构的复杂度。实际使用中应所有权衡。